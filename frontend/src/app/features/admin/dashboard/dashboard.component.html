<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <h1 class="text-3xl font-bold text-gray-900 mb-8">Admin Dashboard</h1>

  @if (isLoading()) {
    <app-loading-spinner></app-loading-spinner>
  } @else if (error()) {
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
      {{ error() }}
      <button (click)="loadDashboardData()" class="ml-4 underline">Retry</button>
    </div>
  } @else {
    <!-- Summary Cards -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
      <div class="bg-white rounded-lg shadow p-6">
        <div class="text-sm font-medium text-gray-500">Total Flats</div>
        <div class="text-3xl font-bold text-gray-900">{{ totalFlats() }}</div>
      </div>
      <div class="bg-white rounded-lg shadow p-6">
        <div class="text-sm font-medium text-gray-500">Occupied</div>
        <div class="text-3xl font-bold text-green-600">{{ totalOccupied() }}</div>
      </div>
      <div class="bg-white rounded-lg shadow p-6">
        <div class="text-sm font-medium text-gray-500">Vacant</div>
        <div class="text-3xl font-bold text-red-600">{{ totalVacant() }}</div>
      </div>
      <div class="bg-white rounded-lg shadow p-6">
        <div class="text-sm font-medium text-gray-500">Overall Occupancy</div>
        <div class="text-3xl font-bold" [class]="getOccupancyColor(overallOccupancy())">
          {{ overallOccupancy() }}%
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="bg-white rounded-lg shadow p-6 mb-8">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">Quick Actions</h2>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <a routerLink="/admin/towers" 
           class="flex items-center justify-center p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors">
          <span class="text-blue-700 font-medium">Manage Towers</span>
        </a>
        <a routerLink="/admin/flats"
           class="flex items-center justify-center p-4 bg-green-50 hover:bg-green-100 rounded-lg transition-colors">
          <span class="text-green-700 font-medium">Manage Flats</span>
        </a>
        <a routerLink="/admin/bookings"
           class="flex items-center justify-center p-4 bg-yellow-50 hover:bg-yellow-100 rounded-lg transition-colors">
          <span class="text-yellow-700 font-medium">Manage Bookings</span>
        </a>
        <a routerLink="/admin/tenants"
           class="flex items-center justify-center p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition-colors">
          <span class="text-purple-700 font-medium">Manage Tenants</span>
        </a>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <!-- Occupancy by Tower -->
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">Occupancy by Tower</h2>
        @if (occupancyReport().length === 0) {
          <p class="text-gray-500">No towers found. Add towers to see occupancy data.</p>
        } @else {
          <div class="space-y-4">
            @for (tower of occupancyReport(); track tower.tower_id) {
              <div class="border rounded-lg p-4" [class]="getOccupancyBgColor(tower.occupancy_percentage)">
                <div class="flex justify-between items-center mb-2">
                  <span class="font-medium text-gray-900">{{ tower.tower_name }}</span>
                  <span class="font-bold" [class]="getOccupancyColor(tower.occupancy_percentage)">
                    {{ tower.occupancy_percentage }}%
                  </span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                  <div class="h-2 rounded-full transition-all"
                       [style.width.%]="tower.occupancy_percentage"
                       [class]="tower.occupancy_percentage >= 80 ? 'bg-green-500' : tower.occupancy_percentage >= 50 ? 'bg-yellow-500' : 'bg-red-500'">
                  </div>
                </div>
                <div class="flex justify-between text-sm text-gray-600 mt-2">
                  <span>{{ tower.occupied_flats }} occupied</span>
                  <span>{{ tower.vacant_flats }} vacant</span>
                  <span>{{ tower.total_flats }} total</span>
                </div>
              </div>
            }
          </div>
        }
      </div>

      <!-- Booking Statistics -->
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">Booking Statistics (This Month)</h2>
        @if (bookingReport()) {
          <div class="space-y-4">
            <div class="grid grid-cols-3 gap-4">
              <div class="text-center p-4 bg-yellow-50 rounded-lg">
                <div class="text-2xl font-bold text-yellow-600">{{ bookingReport()!.total.pending }}</div>
                <div class="text-sm text-gray-600">Pending</div>
              </div>
              <div class="text-center p-4 bg-green-50 rounded-lg">
                <div class="text-2xl font-bold text-green-600">{{ bookingReport()!.total.approved }}</div>
                <div class="text-sm text-gray-600">Approved</div>
              </div>
              <div class="text-center p-4 bg-red-50 rounded-lg">
                <div class="text-2xl font-bold text-red-600">{{ bookingReport()!.total.declined }}</div>
                <div class="text-sm text-gray-600">Declined</div>
              </div>
            </div>
            <div class="border-t pt-4">
              <h3 class="font-medium text-gray-700 mb-2">This Period</h3>
              <div class="flex justify-between text-sm">
                <span class="text-gray-600">New Pending:</span>
                <span class="font-medium">{{ bookingReport()!.period_counts.pending }}</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-gray-600">Approved:</span>
                <span class="font-medium">{{ bookingReport()!.period_counts.approved }}</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-gray-600">Declined:</span>
                <span class="font-medium">{{ bookingReport()!.period_counts.declined }}</span>
              </div>
              <div class="flex justify-between text-sm font-medium border-t mt-2 pt-2">
                <span>Total:</span>
                <span>{{ bookingReport()!.period_counts.total }}</span>
              </div>
            </div>
          </div>
        } @else {
          <p class="text-gray-500">No booking data available.</p>
        }
      </div>
    </div>
  }
</div>
